# Telegram MCP Bridge

Инструментарий, который подключает ваш личный аккаунт Telegram к [Model Context Protocol](https://github.com/modelcontextprotocol) и позволяет использовать его в ChatGPT. Сервер предоставляет инструменты для перечисления групп/каналов и полнотекстового поиска по историям чатов.

> ⚠️ **Важно.** Сервер работает от имени вашего личного аккаунта Telegram. Не запускайте его на недоверенных машинах и не делитесь сессией с третьими лицами.

## Возможности

- `telegram_list_groups` — выводит список групп и каналов, где состоит авторизованный пользователь.
- `telegram_search_messages` — ищет сообщения в выбранном чате по ключевым словам и возвращает как структурированный ответ, так и короткий текстовый дайджест.
- CLI-команды для интерактивного логина (`tgbot-mcp login`), проверки авторизации (`tgbot-mcp whoami`) и запуска MCP сервера (`tgbot-mcp run`).

## Требования

- Python 3.11 или новее.
- Зарегистрированное Telegram API приложение (получите `api_id` и `api_hash` на <https://my.telegram.org>). 

## Установка

```bash
python -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install .
```

## Настройка окружения

1. Создайте файл `.env` рядом с проектом или задайте переменные окружения напрямую:

   ```env
   TELEGRAM_API_ID=123456
   TELEGRAM_API_HASH=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   TELEGRAM_SESSION_PATH=~/.tgbot_mcp/telegram.session
   ```

   Вместо `TELEGRAM_SESSION_PATH` можно использовать `TELEGRAM_SESSION_STRING`, если вы хотите хранить сессию в виде строки.

2. Выполните интерактивный вход, чтобы сохранить сессию:

   ```bash
   tgbot-mcp login
   ```

   Команда запросит номер телефона, код из Telegram и (при необходимости) пароль двухфакторной аутентификации. По окончании вы получите файл сессии либо строку, в зависимости от выбранных параметров.

3. Проверьте, что авторизация выполнена корректно:

   ```bash
   tgbot-mcp whoami
   ```

   В ответ должны отобразиться ID и имя вашего аккаунта.

## Запуск MCP сервера

Для интеграции с ChatGPT (в режиме Model Context Protocol) требуется STDIO-сервер. Запуск осуществляется одной командой:

```bash
tgbot-mcp run
```

Команда блокирует текущий терминал и ждёт подключения клиента MCP (например, браузерного ChatGPT).

## Подключение к ChatGPT

1. Откройте ChatGPT в браузере и перейдите в **Settings → Model Context Protocol → Add local server**.
2. В качестве команды запуска укажите `tgbot-mcp run` (при необходимости — полный путь к исполняемому файлу). ChatGPT автоматически создаст STDIO-процесс и подключится к инструментам.
3. После подключения в панели MCP появятся два инструмента: `telegram_list_groups` и `telegram_search_messages`. Теперь ChatGPT сможет вызывать их по необходимости.

## Форматы инструментов

### telegram_list_groups

- **Вход:**
  - `limit` (int, по умолчанию 50) — максимальное число элементов.
  - `include_private` (bool, по умолчанию `true`) — включать ли приватные группы.
  - `include_channels` (bool, по умолчанию `false`) — включать ли каналы.
- **Выход:** массив объектов с полями `id`, `title`, `type`, `username`, а также метаданными о типе и публичности чата.

### telegram_search_messages

- **Вход:**
  - `chat` (string) — идентификатор, username, ссылка `t.me/...` или точное название диалога.
  - `query` (string) — текст запроса.
  - `limit` (int, по умолчанию 20) — количество сообщений в выдаче.
- **Выход:** сведения о чате и список найденных сообщений (ID, дата, отправитель, сниппет текста, ссылка).

## Советы по безопасности

- Ограничьте доступ к машине, на которой работает сервер.
- Храните файл сессии или строку в защищённом месте (например, используйте менеджер секретов).
- При необходимости быстро отозвать доступ — удалите файл сессии и выполните `tgbot-mcp login` заново.

## Лицензия

Проект распространяется по лицензии MIT (см. `pyproject.toml`).
